<tr id="issue-<%= issue.id %>" level="<%= level.to_s %>" class="<%= issue.tracker.try(:scrummer_caption).to_s.downcase %>-issue hascontextmenu <%= cycle('odd', 'even') %> <%= issue.css_classes %> <%= level > 0 ? "idnt idnt-#{level}" : nil %> <%= issue.direct_children.length > 0 ? "group open" : nil%>">
	<% if hierarchy %>	
	  <td class="select-issue-td checkbox hide-when-print"><%= check_box_tag("ids[]", issue.id, false, :id => nil) %></td>
	    <% end %>
	  
	  <% query.columns.each do |column| %>
	  	<td class='<%= column.css_classes%>'>
	  		<%= scrum_column_content(column, issue) %>
	  	</td>
	  <% end %>    
	  
	<%= hidden_field_tag("position-" + issue.id.to_s, issue.position) %>
	
	<td class='issue-actions'>
		
	  	<!--Remove 'add_child' form task and test trackers -->
	  	<%if !(issue.is_task? || issue.is_test? || issue.is_spike?)%>
	  	<%= link_to_remote image_tag( scrummer_image_path('add_issue.gif') ), 
	  										 :url => {:controller => :scrum_userstories, :action => 'get_inline_issue_form', :list_id => list_id},
	  										 :with => "'parent_issue_id=#{issue.id}&project_id=#{@project.id}'",
	  										 :update => "issue-#{issue.id}-inline-child" %>
			<%end%>
	  	<%= link_to_remote image_tag( scrummer_image_path('edit_issue.gif') ), 
	  										 :url => {:controller => :scrum_userstories, :action => 'get_inline_issue_form', :list_id => list_id, :from_sprint => from_sprint},
	  										 :with => "'issue_id=#{issue.id}&project_id=#{@project.id}'",
	  										 :update => "issue-#{issue.id}-inline-child" %>
											 
	  	<% issues_list_url = url_for(:controller => :scrum_userstories, :action => :issues_list) %>
	  	<%= link_to_remote image_tag( scrummer_image_path('remove_issue.gif') ), 
	  										 :url => (issue_path issue.id),
	  										 :method => :delete,
										     :confirm => "Are you sure?",
	  										 :with => "'back_url=' + encodeURIComponent('#{issues_list_url}?query_id=#{ query.id }&project_id=#{@project.identifier}&list_id=#{list_id}')",
	  										 :update => list_id %>
	  </td>	    
	<!-- The following Tr is sued as a place holder for inline-add-child -->
</tr>

<script>
	<% userstory_custom_field = query.columns.find{|column| column.custom_field.scrummer_caption == :story_size if column.is_a?(QueryCustomFieldColumn)} %>
	$j('#issue-' + "<%= issue.id %>" + '-custom-field-' + "<%= userstory_custom_field.name %>").editable('<%= url_for :controller => :scrum_userstories, :action => :update_single_field, :params => {:project_id => @project.id, :hierarchy => hierarchy, :query => query, :list_id => list_id, :from_sprint => from_sprint}%>',
			{
			 	onblur 		 : 'submit',
			 	placeholder: '<span class="edit-placeholder">Edit</span>',
			 	submitdata : {
			 									authenticity_token : '<%= form_authenticity_token %>'
			 							 },
			 	indicator  : '<%= image_tag 'loading.gif'%>' ,
			 	data: "<%= storysize_possible_values(issue, userstory_custom_field.custom_field.possible_values) %>",
			 	type: 'select',
			 	ignoreResponse: true
		});	
			
	$j('.edit').editable('<%= url_for :controller => :scrum_userstories, :action => :update_single_field, :params => {:project_id => @project.id, :hierarchy => hierarchy, :query => query, :list_id => list_id, :from_sprint => from_sprint}%>',
		{
		 	onblur 		 : 'submit',
		 	placeholder: '<span class="edit-placeholder">Edit</span>',
		 	submitdata : {
		 									authenticity_token : '<%= form_authenticity_token %>'
		 							 },
		 	indicator  : '<%= image_tag 'loading.gif'%>' ,
		 	data: function(value, settings) {
		 	  return $j(this).hasClass("addition") ? "+0" : value;
		 	},
		 	ignoreResponse: true
		});
			
		$j('#issue-' + "<%= issue.id %>" +'-status').editable('<%= url_for :controller => :scrum_userstories, :action => :update_single_field, :params => {:project_id => @project.id, :hierarchy => hierarchy, :query => query, :list_id => list_id, :from_sprint => from_sprint}%>',
				{
				 	onblur 		 : 'submit',
				 	submitdata : {
				 									authenticity_token : '<%= form_authenticity_token %>'
				 							 },
				 	indicator  : '<%= image_tag 'loading.gif'%>' ,
				 	data: "<%= issue_allowed_statuses(issue) %>",
				 	type: 'select',
				 	ignoreResponse: true
			});		
</script>
